# Development overrides for docker-compose.yml
# This file extends the base configuration for development

services:
  server:
    # Expose port for direct access during development
    ports:
      - "8081:8080"
    # Add development environment variables
    environment:
      - DELETION_TOKEN_PEPPER=dev-pepper-change-me
      - LOG_LEVEL=DEBUG
    # Add volume for live code reloading (if needed for future development)
    volumes:
      - ./server/src:/app/src:ro
    # Enable debug logging
    command: ["/app/bin/cc.delerium", "--log-level=debug"]
    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  web:
    # Expose additional ports for development
    ports:
      - "8080:80"
      - "8082:443"
    # Add development-specific nginx config
    volumes:
      - ./client:/usr/share/nginx/html:ro
      - ./reverse-proxy/nginx-dev.conf:/etc/nginx/nginx.conf:ro
      - ./reverse-proxy/default.conf:/etc/nginx/conf.d/default.conf:ro
      - ./reverse-proxy/dev.conf:/etc/nginx/conf.d/dev.conf:ro
    # Add development environment
    environment:
      - NGINX_ENVSUBST_TEMPLATE_DIR=/etc/nginx/templates
      - NGINX_ENVSUBST_OUTPUT_DIR=/etc/nginx/conf.d
