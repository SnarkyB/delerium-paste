# Architecture Diagrams

## Current State (Before Refactoring)

```
???????????????????????????????????????????????????
?                   app.ts                        ?
?               (505 lines)                       ?
?                                                 ?
?  ? Crypto functions (encrypt/decrypt)          ?
?  ? Base64url encoding                          ?
?  ? PoW solving                                 ?
?  ? API calls                                   ?
?  ? DOM manipulation                            ?
?  ? Form validation                             ?
?  ? Routing                                     ?
?  ? State management                            ?
?                                                 ?
?  EVERYTHING IN ONE FILE! ??                    ?
???????????????????????????????????????????????????
                        ?
                        ?
              ??????????????????????
              ?                    ?
    ???????????????????   ?????????????????
    ?  security.ts    ?   ?  delete.ts    ?
    ?  (475 lines)    ?   ?  (63 lines)   ?
    ???????????????????   ?????????????????
```

**Problems:**
- ? Hard to test (everything coupled)
- ? Hard to extend (modify core files)
- ? Hard to understand (too many responsibilities)
- ? Hard to reuse (crypto tied to UI)

---

## Target State (After All 13 PRs)

```
???????????????????????????????????????????????????????????????????
?                    PRESENTATION LAYER                           ?
?  (UI, Pages, Components, Router)                                ?
?                                                                 ?
?  ????????????????  ????????????????  ????????????????         ?
?  ? CreatePage   ?  ? ViewPage     ?  ? DeletePage   ?         ?
?  ????????????????  ????????????????  ????????????????         ?
???????????????????????????????????????????????????????????????????
                            ? depends on
                            ?
???????????????????????????????????????????????????????????????????
?                   APPLICATION LAYER                             ?
?  (Use Cases, Services, State)                                   ?
?                                                                 ?
?  ????????????????  ????????????????  ????????????????         ?
?  ? CreatePaste  ?  ? ViewPaste    ?  ? DeletePaste  ?         ?
?  ?  UseCase     ?  ?  UseCase     ?  ?  UseCase     ?         ?
?  ????????????????  ????????????????  ????????????????         ?
???????????????????????????????????????????????????????????????????
                            ? depends on
                            ?
???????????????????????????????????????????????????????????????????
?                      CORE LAYER                                 ?
?  (Domain Models, Validators, Interfaces)                        ?
?  NO EXTERNAL DEPENDENCIES                                       ?
?                                                                 ?
?  ????????????????  ????????????????  ????????????????         ?
?  ?   Models     ?  ?  Validators  ?  ?  Interfaces  ?         ?
?  ?              ?  ?              ?  ?              ?         ?
?  ? ? Paste      ?  ? ? Content    ?  ? ? ICrypto    ?         ?
?  ? ? Result<T>  ?  ? ? Password   ?  ? ? IApiClient ?         ?
?  ????????????????  ????????????????  ????????????????         ?
???????????????????????????????????????????????????????????????????
                            ? implements
                            ?
???????????????????????????????????????????????????????????????????
?                  INFRASTRUCTURE LAYER                           ?
?  (Adapters, External Dependencies)                              ?
?                                                                 ?
?  ????????????????  ????????????????  ????????????????         ?
?  ?  AesGcm      ?  ? HttpClient   ?  ? PowSolver    ?         ?
?  ?  Crypto      ?  ?              ?  ?              ?         ?
?  ????????????????  ????????????????  ????????????????         ?
???????????????????????????????????????????????????????????????????
```

**Benefits:**
- ? Easy to test (layers isolated)
- ? Easy to extend (implement interfaces)
- ? Easy to understand (clear boundaries)
- ? Easy to reuse (core is portable)

---

## PR #1: Crypto Module (COMPLETED)

### What We Extracted

```
???????????????????????????????????????????????????????????????????
?                   app.ts (BEFORE)                               ?
?  ????????????????????????????????????????????????????????????  ?
?  ?  function b64u(bytes) { ... }              ????????????????????
?  ?  function ub64u(s) { ... }                 ????????????????????
?  ?  function genKey() { ... }                 ????????????????????
?  ?  function genIV() { ... }                  ????????????????????
?  ?  function encryptString(text) { ... }      ????????????????????
?  ?  function decryptParts(key, iv, ct) { ...} ????????????????????
?  ????????????????????????????????????????????????????????????  ?
?                                                                 ?
?  Plus PoW, API calls, DOM, validation, routing...              ?
???????????????????????????????????????????????????????????????????
                                                                  ?
                                        Extracted ?????????????????
                                                  ?
                                                  ?
???????????????????????????????????????????????????????????????????
?              client/src/core/crypto/                            ?
?                                                                 ?
?  ????????????????????????????????????????????????????????????  ?
?  ?  interfaces.ts                                           ?  ?
?  ?  ??????????????????????????????????????                 ?  ?
?  ?  ?  interface ICryptoProvider {       ?                 ?  ?
?  ?  ?    encrypt(text): Promise<Result>  ?  ??? Interface  ?  ?
?  ?  ?    decrypt(input): Promise<string> ?                 ?  ?
?  ?  ?    encryptWithPassword(...)        ?                 ?  ?
?  ?  ?    decryptWithPassword(...)        ?                 ?  ?
?  ?  ?  }                                  ?                 ?  ?
?  ?  ??????????????????????????????????????                 ?  ?
?  ????????????????????????????????????????????????????????????  ?
?                                                                 ?
?  ????????????????????????????????????????????????????????????  ?
?  ?  aes-gcm.ts                                              ?  ?
?  ?  ??????????????????????????????????????                 ?  ?
?  ?  ?  class AesGcmCryptoProvider        ?                 ?  ?
?  ?  ?    implements ICryptoProvider {    ?  ??? Impl       ?  ?
?  ?  ?                                     ?                 ?  ?
?  ?  ?    async encrypt(text) { ... }     ?                 ?  ?
?  ?  ?    async decrypt(input) { ... }    ?                 ?  ?
?  ?  ?  }                                  ?                 ?  ?
?  ?  ??????????????????????????????????????                 ?  ?
?  ????????????????????????????????????????????????????????????  ?
?                                                                 ?
?  ????????????????????????????????????????????????????????????  ?
?  ?  encoding.ts                                             ?  ?
?  ?    ? encodeBase64Url(bytes)          ??? Utilities      ?  ?
?  ?    ? decodeBase64Url(string)                            ?  ?
?  ????????????????????????????????????????????????????????????  ?
?                                                                 ?
?  ????????????????????????????????????????????????????????????  ?
?  ?  index.ts                                                ?  ?
?  ?    ? createCryptoProvider()          ??? Factory        ?  ?
?  ?    ? exports all interfaces                             ?  ?
?  ????????????????????????????????????????????????????????????  ?
???????????????????????????????????????????????????????????????????
```

### Dependency Flow

```
??????????????????????
?   app.ts (old)     ?
?                    ?
?   Future PR:       ?
?   Will import      ?
?   from crypto/     ?
??????????????????????
          ?
          ? (currently independent)
          ?
          ?
???????????????????????????????????
?  core/crypto/index.ts           ?
?  (Public API)                   ?
???????????????????????????????????
         ? exports
         ?
??????????????????????????????????????????????
?  core/crypto/interfaces.ts                 ?
?  ? ICryptoProvider interface               ?
?  ? EncryptionResult type                   ?
?  ? DecryptionInput type                    ?
??????????????????????????????????????????????
         ? implemented by
         ?
??????????????????????????????????????????????
?  core/crypto/aes-gcm.ts                    ?
?  ? AesGcmCryptoProvider class              ?
?    (implements ICryptoProvider)            ?
??????????????????????????????????????????????
         ? uses
         ?
??????????????????????????????????????????????
?  core/crypto/encoding.ts                   ?
?  ? encodeBase64Url()                       ?
?  ? decodeBase64Url()                       ?
??????????????????????????????????????????????
```

---

## Extension Example: Adding Custom Crypto

```
????????????????????????????????????????????????????????????
?  Your Custom Implementation                              ?
?                                                          ?
?  import { ICryptoProvider } from './core/crypto';       ?
?                                                          ?
?  class MyCustomCrypto implements ICryptoProvider {      ?
?    async encrypt(text): Promise<EncryptionResult> {     ?
?      // Your encryption logic                           ?
?      // Could be ChaCha20, RSA, or anything!           ?
?    }                                                     ?
?    // ... implement other methods                       ?
?  }                                                       ?
?                                                          ?
?  // Use it:                                             ?
?  const crypto = new MyCustomCrypto();                   ?
?  const result = await crypto.encrypt('Hello');          ?
????????????????????????????????????????????????????????????
```

**No core code modification needed!** ??

---

## Comparison: Monolithic vs Modular

### Monolithic (Before)

```
app.ts (505 lines)
??? Crypto functions
??? PoW solver
??? API calls
??? DOM manipulation
??? Form validation
??? Everything else

Problems:
? Change crypto ? Retest everything
? Want custom crypto ? Modify app.ts
? Test crypto alone ? Can't, it's coupled
```

### Modular (After PR #1)

```
core/
??? crypto/
?   ??? interfaces.ts      ? Define contract
?   ??? aes-gcm.ts        ? One implementation
?   ??? encoding.ts       ? Utilities
?   ??? index.ts          ? Public API
??? models/
    ??? result.ts         ? Error handling

Benefits:
? Change crypto ? Only test crypto module
? Want custom crypto ? Implement interface
? Test crypto alone ? Easy, it's isolated
```

---

## Layered Architecture (Full Picture)

```
???????????????????????????????????????????????????????????
?  Presentation Layer                                     ?
?  ? UI components                                        ?
?  ? Page controllers                                     ?
?  ? Router                                               ?
?  ? Event handlers                                       ?
?                                                         ?
?  Dependencies: Application layer                        ?
???????????????????????????????????????????????????????????
                     ? calls
                     ?
???????????????????????????????????????????????????????????
?  Application Layer                                      ?
?  ? Use cases (business workflows)                       ?
?  ? Services (orchestration)                             ?
?  ? State management                                     ?
?                                                         ?
?  Dependencies: Core + Infrastructure                    ?
???????????????????????????????????????????????????????????
                     ? uses
                     ?
???????????????????????????????????????????????????????????
?  Core Layer (Domain)                                    ?
?  ? Domain models                                        ?
?  ? Validators (business rules)                          ?
?  ? Interfaces (contracts)                               ?
?                                                         ?
?  Dependencies: NONE ? Pure domain logic                 ?
???????????????????????????????????????????????????????????
                     ? implements
                     ?
???????????????????????????????????????????????????????????
?  Infrastructure Layer                                   ?
?  ? Crypto implementations                               ?
?  ? API clients                                          ?
?  ? Storage adapters                                     ?
?  ? External services                                    ?
?                                                         ?
?  Dependencies: Core interfaces                          ?
???????????????????????????????????????????????????????????
```

**Dependency Rule**: Inner layers don't depend on outer layers.

---

## Timeline: 13 PRs

```
Week 1-2: Frontend Modularization
???????????????????????????????
? 1  ? 2  ? 3  ? 4  ? 5  ? 6  ?
??  ? ?? ? ?? ? ?? ? ?? ? ?? ?
?Cry ?Val ?API ?PoW ?Use ? DI ?
?pto ?idt ?Cli ?Slv ?Cse ?Wir ?
???????????????????????????????

Week 3-4: Backend Modularization
??????????????????????????
? 7  ? 8  ? 9  ? 10 ? 11 ?
? ?? ? ?? ? ?? ? ?? ? ?? ?
?Dom ?Prt ?Inf ?Use ?Koin?
?ain ?Int ?Adp ?Cse ? DI ?
??????????????????????????

Week 5-6: Documentation
???????????
? 12 ? 13 ?
? ?? ? ?? ?
?Arc ?Rdm ?
?Doc ?Upd ?
???????????

Legend:
? = Completed
?? = Pending
```

---

## Benefits Summary

### Before Refactoring
```
????????????????????????????????????
?  One Big File                    ?
?  ? Hard to test                  ?
?  ? Hard to extend                ?
?  ? Hard to understand            ?
?  ? High coupling                 ?
?  ? Low cohesion                  ?
????????????????????????????????????
```

### After Refactoring (PR #1 Progress)
```
????????????????????????????????????
?  Modular Architecture            ?
?  ? Easy to test                 ?
?  ? Easy to extend               ?
?  ? Easy to understand           ?
?  ? Low coupling                 ?
?  ? High cohesion                ?
????????????????????????????????????
```

---

**Visual Summary Complete!** ??

See other documentation:
- `PR-001-SUMMARY.md` - What we accomplished
- `docs/prs/PR-001-CRYPTO-MODULE.md` - Detailed PR docs
- `docs/prs/QUICK-START.md` - Review guide
