# Docker secrets overlay â€” compose with the base stack:
#   docker compose -f docker-compose.yml -f docker-compose.secrets.yml up -d
#
# Secrets are mounted read-only at /run/secrets/<name> inside the container.
# The server reads them via readSecret() in App.kt, falling back to env vars.
#
# Setup:
#   mkdir -p secrets
#   openssl rand -hex 32 > secrets/deletion-token-pepper.txt
#   # For DATA_ENC_KEYRING: let the server auto-generate on first start, then
#   # copy /data/keyring.json out and store it here for reproducible restarts:
#   cp <volume-mount>/keyring.json secrets/data-enc-keyring.json
#   chmod 600 secrets/*
#
# The secrets/ directory is gitignored; never commit actual secret values.

secrets:
  deletion-token-pepper:
    file: ./secrets/deletion-token-pepper.txt

  data-enc-keyring:
    file: ./secrets/data-enc-keyring.json

services:
  server:
    secrets:
      - deletion-token-pepper
      - data-enc-keyring
    environment:
      # Clear env-var delivery of secrets; the server reads from /run/secrets/ instead.
      # Leave DATA_ENC_KEYRING_PATH so the server still knows where to persist the keyring.
      DELETION_TOKEN_PEPPER: ""
